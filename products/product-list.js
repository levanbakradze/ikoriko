// Product Database - Same as main.js
const productsDatabase = {
    gym: [
        {
            id: 1,
            title: "წოლჭიმის დანადგარი",
            price: "₾350",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym",
            link: "products/product-1.html"
        },
        {
            id: 2,
            title: "მულტიფუნქციური ტრენაჟორი",
            price: "₾580",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 3,
            title: "ჰანტელების ნაკრები",
            price: "₾250",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 4,
            title: "ძალოვანი ღეროები",
            price: "₾180",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 5,
            title: "კარდიო ველოსიპედი",
            price: "₾420",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 6,
            title: "ფანქრული ღეროები",
            price: "₾300",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 7,
            title: "ღია ტრენაჟორი",
            price: "₾380",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 8,
            title: "ზურგის ტრენაჟორი",
            price: "₾290",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 9,
            title: "ლეგ პრესი",
            price: "₾520",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        },
        {
            id: 10,
            title: "ტრენაჟორთა კომპლექსი",
            price: "₾750",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "gym"
        }
    ],
    armwrestling: [
        {
            id: 11,
            title: "მკლავჭიდის მაგიდა",
            price: "₾157",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 12,
            title: "მკლავჭიდის სახელური",
            price: "₾360",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 13,
            title: "ხელის ღეროები",
            price: "₾120",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 14,
            title: "რეგულირებადი მაგიდა",
            price: "₾280",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 15,
            title: "ძალის ტრენერი",
            price: "₾440",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 16,
            title: "პროფესიონალური მაგიდა",
            price: "₾520",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 17,
            title: "ხელის ტრენერი",
            price: "₾190",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 18,
            title: "ცხრილის ტრენერი",
            price: "₾340",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 19,
            title: "მოძრაობის ტრენერი",
            price: "₾230",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        },
        {
            id: 20,
            title: "კომპლექსური ტრენერი",
            price: "₾650",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "armwrestling"
        }
    ],
    accessories: [
        {
            id: 21,
            title: "ხელის ტერფები",
            price: "₾50",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 22,
            title: "დაცვითი ხელთათმანები",
            price: "₾35",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 23,
            title: "ელბოუ პედები",
            price: "₾45",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 24,
            title: "რისტ სტრეპები",
            price: "₾25",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 25,
            title: "მკლავჭიდის ბალიშები",
            price: "₾40",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 26,
            title: "ღრმა ფეხსაცმელები",
            price: "₾80",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 27,
            title: "ტრენინგ ფუტბოლკები",
            price: "₾60",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 28,
            title: "ღემბანის პროტექტორები",
            price: "₾55",
            image: "https://images.unsplash.com/photo-1745233710584-332f527ecd0c?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 29,
            title: "მაგნეზიუმის ფხვნილი",
            price: "₾15",
            image: "https://images.unsplash.com/photo-1633989464081-16ccd31287a1?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        },
        {
            id: 30,
            title: "აქსესუარების ნაკრები",
            price: "₾120",
            image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxواG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
            category: "accessories"
        }
    ]
};

// Global variables
let currentProducts = [];
let currentPage = 1;
const productsPerPage = 9;
let currentCategory = 'gym'; // Default category

// Category titles mapping
const categoryTitles = {
    'all': 'ყველა პროდუქტი',
    'gym': 'დარბაზის დანადგარები',
    'armwrestling': 'მკლავჭიდის სავარჯიშო დანადგარები',
    'accessories': 'მკლავჭიდის აქსესუარები'
};

// Mobile menu toggle
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const burgerMenu = document.querySelector('.burger-menu');
    
    mobileMenu.classList.toggle('active');
    burgerMenu.classList.toggle('active');
}

// Get URL parameter
function getUrlParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

// Create product card HTML
function createProductCard(product) {
    return `
        <div class="product-card">
            ${product.link ? `<a href="${product.link}">` : ''}
                <img src="${product.image}" alt="${product.title}" class="product-image">
                <div class="product-info">
                    <h3 class="product-title">${product.title}</h3>
                    <div class="product-bottom">
                        <p class="product-price">${product.price}</p>
                        <button class="details-btn" onclick="showProductDetails(${product.id})">დეტალები</button>
                    </div>
                </div>
            ${product.link ? `</a>` : ''}
        </div>
    `;
}

// Show product details (placeholder function)
function showProductDetails(productId) {
    alert(`დეტალები პროდუქტისთვის ID: ${productId}\n(ეს ფუნქცია განვითარების პროცესშია)`);
}

// Update page title and breadcrumb
function updatePageInfo(category) {
    const title = categoryTitles[category];
    document.getElementById('page-title').textContent = title;
    document.getElementById('breadcrumb-category').textContent = title;
    document.title = `${title} - ხელნაკეთი დანადგარები`;
}

// Update filter sidebar active state
function updateFilterActive(category) {
    function updateFilterActive(category) {
    // Remove active class from all options
    document.querySelectorAll('.filter-option').forEach(option => {
        option.classList.remove('active');
    });
    
    // Add active class to the correct option
    const filterOptions = document.querySelectorAll('.filter-option');
    filterOptions.forEach(option => {
        const onclick = option.getAttribute('onclick');
        if (onclick && onclick.includes(`filterProducts('${category}')`)) {
            option.classList.add('active');
        }
    });
}
}
    
   

// Filter products
function filterProducts(category) {
    currentCategory = category;
    
    // Update page info
    updatePageInfo(category);
    
    // Update filter active state
    updateFilterActive(category);
    
    // Get filtered products
    if (category === 'all') {
        currentProducts = [...productsDatabase.gym, ...productsDatabase.armwrestling, ...productsDatabase.accessories];
    } else {
        currentProducts = productsDatabase[category] || [];
    }

    // Reset pagination
    currentPage = 1;

    // Render products and pagination
    renderProducts();
    renderPagination();
    
    // Update URL without reload
    const newUrl = `${window.location.pathname}?category=${category}`;
    window.history.pushState({category: category}, '', newUrl);
}

// Render products
function renderProducts() {
    const grid = document.getElementById('products-grid');
    
    // Clear existing products
    grid.innerHTML = '';

    // Calculate pagination
    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const paginatedProducts = currentProducts.slice(startIndex, endIndex);

    // Render products
    if (paginatedProducts.length === 0) {
        grid.innerHTML = '<div style="text-align: center; color: #666; font-size: 18px; padding: 40px;">პროდუქტები არ მოიძებნა</div>';
        return;
    }

    paginatedProducts.forEach(product => {
        const productHTML = createProductCard(product);
        grid.innerHTML += productHTML;
    });
}

// Render pagination
function renderPagination() {
    const pagination = document.getElementById('pagination');
    const totalPages = Math.ceil(currentProducts.length / productsPerPage);
    
    pagination.innerHTML = '';
    
    if (totalPages <= 1) return;

    // Previous button
    const prevBtn = document.createElement('button');
    prevBtn.className = 'pagination-btn';
    prevBtn.innerHTML = '‹';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => goToPage(currentPage - 1);
    pagination.appendChild(prevBtn);

    // Page numbers
    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, currentPage + 2);

    // Adjust range if at beginning or end
    if (currentPage <= 3) {
        endPage = Math.min(5, totalPages);
    }
    if (currentPage >= totalPages - 2) {
        startPage = Math.max(1, totalPages - 4);
    }

    // First page and ellipsis
    if (startPage > 1) {
        const firstBtn = document.createElement('button');
        firstBtn.className = 'pagination-btn';
        firstBtn.innerHTML = '1';
        firstBtn.onclick = () => goToPage(1);
        pagination.appendChild(firstBtn);

        if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.padding = '0 10px';
            ellipsis.style.color = '#999';
            pagination.appendChild(ellipsis);
        }
    }

    // Page numbers in range
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
        pageBtn.innerHTML = i;
        pageBtn.onclick = () => goToPage(i);
        pagination.appendChild(pageBtn);
    }

    // Last page and ellipsis
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.padding = '0 10px';
            ellipsis.style.color = '#999';
            pagination.appendChild(ellipsis);
        }

        const lastBtn = document.createElement('button');
        lastBtn.className = 'pagination-btn';
        lastBtn.innerHTML = totalPages;
        lastBtn.onclick = () => goToPage(totalPages);
        pagination.appendChild(lastBtn);
    }

    // Next button
    const nextBtn = document.createElement('button');
    nextBtn.className = 'pagination-btn';
    nextBtn.innerHTML = '›';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => goToPage(currentPage + 1);
    pagination.appendChild(nextBtn);
}

// Go to specific page
function goToPage(page) {
    const totalPages = Math.ceil(currentProducts.length / productsPerPage);
    
    if (page < 1 || page > totalPages) return;
    
    currentPage = page;
    renderProducts();
    renderPagination();
    
    // Scroll to top of products section
    document.querySelector('.products-section').scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
    });
}

// Initialize page based on URL parameter
function initializePage() {
    // Get category from URL parameter
    const urlCategory = getUrlParameter('category') || 'gym';
    
    // Validate category
    if (!categoryTitles[urlCategory]) {
        currentCategory = 'gym';
    } else {
        currentCategory = urlCategory;
    }
    
    // Load products for the category
    filterProducts(currentCategory);
}

// Handle browser back/forward navigation
window.addEventListener('popstate', function(event) {
    if (event.state && event.state.category) {
        filterProducts(event.state.category);
    } else {
        // Fallback to URL parameter
        initializePage();
    }
});

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Initialize page with category from URL
    initializePage();
    
    // Handle window resize for responsive design
    window.addEventListener('resize', function() {
        // Add any resize handlers if needed
    });
});
